import{hW as xt,hX as vt,hY as dt,cQ as Mt,hK as wt,hZ as bt,k as h,l as P,m as Rt,b9 as _t,bA as q,h_ as Ct,bB as it,cP as R,h$ as Ot,i0 as st,i1 as H,i2 as Nt,g as lt,fi as j,i3 as B,i4 as J,eO as K,eN as Q,i5 as St,cg as Et,i6 as jt,b$ as Bt,c0 as Lt,hH as L,i7 as ct,i8 as X,i9 as Vt,cV as zt,g4 as Wt,ia as Gt,ib as It,eZ as Yt,ic as kt}from"./index-6a6230c9.js";import{e as ut}from"./mat3f64-221ce671.js";import{e as M,o as S}from"./mat4f64-1413b4a7.js";import{c as b}from"./spatialReferenceEllipsoidUtils-bcb386df.js";import{m as qt,p as Ut,t as tt,o as Zt}from"./MeshLocalVertexSpace-4bd29f55.js";import{m as Dt}from"./MeshGeoreferencedRelativeVertexSpace-c8574543.js";import{v as G,y as Ht,x as Jt}from"./quat-b2f94896.js";import{e as U}from"./quatf64-3363c48e.js";import{n as x,s as ft,r as w}from"./vec32-0d2d8ac6.js";import{i as $,T as A}from"./BufferView-e560afde.js";function T(t=pt){return[t[0],t[1],t[2],t[3]]}function E(t,r,e=T()){return Mt(e,t),e[3]=r,e}function rt(t,r,e=T()){return G(_,t,I(t)),G(et,r,I(r)),Ht(_,et,_),Qt(e,wt(Jt(e,_)))}function Nr(t,r,e,n=T()){return E(xt,t,C),E(vt,r,nt),E(dt,e,ot),rt(C,nt,C),rt(C,ot,n),n}function Sr(t){return t}function Kt(t){return t[3]}function I(t){return bt(t[3])}function Qt(t,r){return t[3]=r,t}const pt=[0,0,1,0],_=U(),et=U();T();const C=T(),nt=T(),ot=T();var Y;let m=Y=class extends _t{constructor(t){super(t),this.translation=q(),this.rotationAxis=Ct(pt),this.rotationAngle=0,this.scale=it(1,1,1)}get rotation(){return E(this.rotationAxis,this.rotationAngle)}set rotation(t){this.rotationAxis=R(t),this.rotationAngle=Kt(t)}get localMatrix(){const t=M();return G(at,this.rotation,I(this.rotation)),Ot(t,at,this.translation,this.scale),t}get localMatrixInverse(){return st(M(),this.localMatrix)}applyLocal(t,r){return H(r,t,this.localMatrix)}applyLocalInverse(t,r){return H(r,t,this.localMatrixInverse)}equals(t){return this===t||t!=null&&Nt(this.localMatrix,t.localMatrix)}clone(){const t={translation:R(this.translation),rotationAxis:R(this.rotationAxis),rotationAngle:this.rotationAngle,scale:R(this.scale)};return new Y(t)}};h([P({type:[Number],nonNullable:!0,json:{write:!0}})],m.prototype,"translation",void 0),h([P({type:[Number],nonNullable:!0,json:{write:!0}})],m.prototype,"rotationAxis",void 0),h([P({type:Number,nonNullable:!0,json:{write:!0}})],m.prototype,"rotationAngle",void 0),h([P({type:[Number],nonNullable:!0,json:{write:!0}})],m.prototype,"scale",void 0),h([P()],m.prototype,"rotation",null),h([P()],m.prototype,"localMatrix",null),h([P()],m.prototype,"localMatrixInverse",null),m=Y=h([Rt("esri.geometry.support.MeshTransform")],m);const at=U(),Xt=m;function gt(t,r){return t.isGeographic||t.isWebMercator&&((r==null?void 0:r.geographic)??!0)}function Er(t,r,e){const n=!t.isGeoreferenced;(e==null?void 0:e.geographic)!=null&&e.geographic!==n&&lt.getLogger(r).warnOnce(`Specifying the 'geographic' parameter (${e.geographic}) for a Mesh vertex space of type "${t.type}" is not supported. This parameter will be ignored.`)}const V=lt.getLogger("esri.geometry.support.meshUtils.normalProjection");function tr(t,r,e,n,o){return W(n)?(z(y.TO_PCPF,$.fromTypedArray(t),A.fromTypedArray(r),A.fromTypedArray(e),n,$.fromTypedArray(o)),o):(V.error("Cannot convert spatial reference to PCPF"),o)}function rr(t,r,e,n,o){return W(n)?(z(y.FROM_PCPF,$.fromTypedArray(t),A.fromTypedArray(r),A.fromTypedArray(e),n,$.fromTypedArray(o)),o):(V.error("Cannot convert to spatial reference from PCPF"),o)}function er(t,r,e){return j(t,r,0,e,b(r),0,t.length/3),e}function nr(t,r,e){return j(t,b(e),0,r,e,0,t.length/3),r}function or(t,r,e){return L(u,e),x(r,t,u),ct(u)||ft(r,r),r}function ar(t,r,e){if(L(u,e),x(r,t,u,4),ct(u)||ft(r,r,4),t!==r)for(let n=3;n<t.length;n+=4)r[n]=t[n];return r}function ir(t,r,e,n,o){if(!W(n))return V.error("Cannot convert spatial reference to PCPF"),o;z(y.TO_PCPF,$.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),A.fromTypedArray(r),A.fromTypedArray(e),n,$.fromTypedArray(o,4*Float32Array.BYTES_PER_ELEMENT));for(let a=3;a<t.length;a+=4)o[a]=t[a];return o}function sr(t,r,e,n,o){if(!W(n))return V.error("Cannot convert to spatial reference from PCPF"),o;z(y.FROM_PCPF,$.fromTypedArray(t,16),A.fromTypedArray(r),A.fromTypedArray(e),n,$.fromTypedArray(o,16));for(let a=3;a<t.length;a+=4)o[a]=t[a];return o}function z(t,r,e,n,o,a){if(!r)return;const i=e.count,c=b(o);if(mt(o))for(let s=0;s<i;s++)n.getVec(s,O),r.getVec(s,g),B(c,O,N,c),J(u,N),t===y.FROM_PCPF&&K(u,u),Q(g,g,u),a.setVec(s,g);else for(let s=0;s<i;s++){n.getVec(s,O),r.getVec(s,g),B(c,O,N,c),J(u,N);const l=St(e.get(s,1));let f=Math.cos(l);t===y.TO_PCPF&&(f=1/f),u[0]*=f,u[1]*=f,u[2]*=f,u[3]*=f,u[4]*=f,u[5]*=f,t===y.FROM_PCPF&&K(u,u),Q(g,g,u),Et(g,g),a.setVec(s,g)}return a}function W(t){return mt(t)||lr(t)}function mt(t){return t.isWGS84||jt(t)||Bt(t)||Lt(t)}function lr(t){return t.isWebMercator}var y;(function(t){t[t.TO_PCPF=0]="TO_PCPF",t[t.FROM_PCPF=1]="FROM_PCPF"})(y||(y={}));const O=q(),g=q(),N=M(),u=ut();function Z(t,r,e){return gt(r.spatialReference,e)?gr(t,r,e):pr(t,r,e)}function yt(t,r,e,n){const{position:o,normal:a,tangent:i}=t;if(!r.isRelative)return{position:o,normal:a,tangent:i};const c=(e==null?void 0:e.localMatrix)??S;return Z({position:w(new Float64Array(o.length),o,c),normal:a!=null?or(a,new Float32Array(a.length),c):null,tangent:i!=null?ar(i,new Float32Array(i.length),c):null},r.getOriginPoint(n),{geographic:!r.isGeoreferenced})}function cr(t,r,e){if(e!=null&&e.useTransform){const{position:n,normal:o,tangent:a}=t,{x:i,y:c,z:s}=r,l=it(i,c,s??0);return{vertexAttributes:{position:n,normal:o,tangent:a},vertexSpace:e.geographic??1?new qt({origin:l}):new Dt({origin:l}),transform:new Xt}}return{vertexAttributes:Z(t,r,e),vertexSpace:new Ut,transform:null}}function k(t,r,e){return gt(r.spatialReference,e)?$r(t,r,e):ht(t,r,e)}function ur(t,r,e,n,o){if(!r.isRelative)return k(t,n,o);const{spatialReference:a}=n,i=yt(t,r,e,a);return n.equals(r.getOriginPoint(a))?ht(i,n,o):k(i,n,o)}function fr({positions:t,transform:r,vertexSpace:e,inSpatialReference:n,outSpatialReference:o,outPositions:a,local:i}){const c=e.isRelative?e.origin:X,s=e.isRelative?(r==null?void 0:r.localMatrix)??S:S;if(e.isGeoreferenced){const p=a??tt(t.length);if(Vt(s,S)?Zt(p,t):w(p,t,s),!zt(c,X)){const[Pt,Ft,Tt]=c;for(let d=0;d<p.length;d+=3)p[d]+=Pt,p[d+1]+=Ft,p[d+2]+=Tt}return j(p,n,0,p,o,0,p.length/3),p}const l=b(n),f=!i&&Wt(n,l)?l:n;B(n,c,F,f),Gt(F,F,s);const v=a??tt(t.length);return w(v,t,F),j(v,f,0,v,o,0,v.length/3),v}function pr(t,r,e){const n=new Float64Array(t.position.length),o=t.position,a=r.x,i=r.y,c=r.z??0,s=D(e?e.unit:null,r.spatialReference);for(let l=0;l<o.length;l+=3)n[l]=o[l]*s+a,n[l+1]=o[l+1]*s+i,n[l+2]=o[l+2]*s+c;return{position:n,normal:t.normal,tangent:t.tangent}}function gr(t,r,e){const n=r.spatialReference,o=$t(r,e,F),a=new Float64Array(t.position.length),i=mr(t.position,o,n,a),c=L(At,o);return{position:i,normal:yr(i,a,t.normal,c,n),tangent:hr(i,a,t.tangent,c,n)}}function mr(t,r,e,n){w(n,t,r);const o=new Float64Array(t.length);return nr(n,o,e)}function yr(t,r,e,n,o){if(e==null)return null;const a=new Float32Array(e.length);return x(a,e,n),rr(a,t,r,o,a),a}function hr(t,r,e,n,o){if(e==null)return null;const a=new Float32Array(e.length);x(a,e,n,4);for(let i=3;i<a.length;i+=4)a[i]=e[i];return sr(a,t,r,o,a),a}function ht(t,r,e){const n=new Float64Array(t.position.length),o=t.position,a=r.x,i=r.y,c=r.z??0,s=D(e?e.unit:null,r.spatialReference);for(let l=0;l<o.length;l+=3)n[l]=(o[l]-a)/s,n[l+1]=(o[l+1]-i)/s,n[l+2]=(o[l+2]-c)/s;return{position:n,normal:t.normal,tangent:t.tangent}}function $r(t,r,e){const n=r.spatialReference;$t(r,e,F);const o=st(Tr,F),a=new Float64Array(t.position.length),i=Ar(t.position,n,o,a),c=L(At,o);return{position:i,normal:Pr(t.normal,t.position,a,n,c),tangent:Fr(t.tangent,t.position,a,n,c)}}function $t(t,r,e){B(t.spatialReference,[t.x,t.y,t.z??0],e,b(t.spatialReference));const n=D(r?r.unit:null,t.spatialReference);return It(e,e,[n,n,n]),e}function Ar(t,r,e,n){const o=er(t,r,n),a=new Float64Array(o.length);return w(a,o,e),a}function Pr(t,r,e,n,o){if(t==null)return null;const a=tr(t,r,e,n,new Float32Array(t.length));return x(a,a,o),a}function Fr(t,r,e,n,o){if(t==null)return null;const a=ir(t,r,e,n,new Float32Array(t.length));return x(a,a,o,4),a}function D(t,r){if(t==null)return 1;const e=Yt(r);return 1/kt(e,"meters",t)}const F=M(),Tr=M(),At=ut(),jr=Object.freeze(Object.defineProperty({__proto__:null,georeference:Z,georeferenceApplyTransform:yt,georeferenceByTransform:cr,project:fr,ungeoreference:k,ungeoreferenceByTransform:ur},Symbol.toStringTag,{value:"Module"}));export{k as D,ur as E,fr as I,Xt as N,Z as O,ir as R,yt as T,tr as _,nr as a,T as b,I as c,jr as d,rt as g,er as h,rr as j,Nr as l,Er as o,cr as q,gt as r,sr as v,Sr as x};
