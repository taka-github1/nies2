import{ez as v,eA as w,R as q,eB as B,cu as V,S as A,eC as d,N as z,eD as P}from"./index-6a6230c9.js";import{t as R}from"./json-48e3ea08.js";function M(e,n){return e?n?4:3:n?3:2}function X(e,n,s,r,i){if(n==null||!n.lengths.length)return null;const l=(i==null?void 0:i.originPosition)==="upperLeft"?-1:1;e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0);const t=e.coords,c=[],o=s?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:a,coords:p}=n,_=M(s,r);let T=0;for(const u of a){const h=C(o,p,T,u,s,r,l);h&&c.push(h),T+=u*_}if(c.sort((u,h)=>{let f=l*u[2]-l*h[2];return f===0&&s&&(f=u[4]-h[4]),f}),c.length){let u=6*c[0][2];t[0]=c[0][0]/u,t[1]=c[0][1]/u,s&&(u=6*c[0][4],t[2]=u!==0?c[0][3]/u:0),(t[0]<o[0]||t[0]>o[1]||t[1]<o[2]||t[1]>o[3]||s&&(t[2]<o[4]||t[2]>o[5]))&&(t.length=0)}if(!t.length){const u=n.lengths[0]?D(p,0,a[0],s,r):null;if(!u)return null;t[0]=u[0],t[1]=u[1],s&&u.length>2&&(t[2]=u[2])}return e}function C(e,n,s,r,i,l,t=1){const c=M(i,l);let o=s,a=s+c,p=0,_=0,T=0,u=0,h=0;for(let E=0,x=r-1;E<x;E++,o+=c,a+=c){const I=n[o],g=n[o+1],m=n[o+2],N=n[a],F=n[a+1],S=n[a+2];let b=I*F-N*g;u+=b,p+=(I+N)*b,_+=(g+F)*b,i&&(b=I*S-N*m,T+=(m+S)*b,h+=b),I<e[0]&&(e[0]=I),I>e[1]&&(e[1]=I),g<e[2]&&(e[2]=g),g>e[3]&&(e[3]=g),i&&(m<e[4]&&(e[4]=m),m>e[5]&&(e[5]=m))}if(u*t>0&&(u*=-1),h*t>0&&(h*=-1),!u)return null;const f=[p,_,.5*u];return i&&(f[3]=T,f[4]=.5*h),f}function D(e,n,s,r,i){const l=M(r,i);let t=n,c=n+l,o=0,a=0,p=0,_=0;for(let T=0,u=s-1;T<u;T++,t+=l,c+=l){const h=e[t],f=e[t+1],E=e[t+2],x=e[c],I=e[c+1],g=e[c+2],m=r?k(h,f,E,x,I,g):L(h,f,x,I);if(m)if(o+=m,r){const N=J(h,f,E,x,I,g);a+=m*N[0],p+=m*N[1],_+=m*N[2]}else{const N=H(h,f,x,I);a+=m*N[0],p+=m*N[1]}}return o>0?r?[a/o,p/o,_/o]:[a/o,p/o]:s>0?r?[e[n],e[n+1],e[n+2]]:[e[n],e[n+1]]:null}function L(e,n,s,r){const i=s-e,l=r-n;return Math.sqrt(i*i+l*l)}function k(e,n,s,r,i,l){const t=r-e,c=i-n,o=l-s;return Math.sqrt(t*t+c*c+o*o)}function H(e,n,s,r){return[e+.5*(s-e),n+.5*(r-n)]}function J(e,n,s,r,i,l){return[e+.5*(r-e),n+.5*(i-n),s+.5*(l-s)]}const y=[0,0];function Z(e,n){if(!n)return null;if("x"in n){const s={x:0,y:0};return[s.x,s.y]=e(n.x,n.y,y),n.z!=null&&(s.z=n.z),n.m!=null&&(s.m=n.m),s}if("xmin"in n){const s={xmin:0,ymin:0,xmax:0,ymax:0};return[s.xmin,s.ymin]=e(n.xmin,n.ymin,y),[s.xmax,s.ymax]=e(n.xmax,n.ymax,y),n.hasZ&&(s.zmin=n.zmin,s.zmax=n.zmax,s.hasZ=!0),n.hasM&&(s.mmin=n.mmin,s.mmax=n.mmax,s.hasM=!0),s}return"rings"in n?{rings:Y(n.rings,e),hasM:n.hasM,hasZ:n.hasZ}:"paths"in n?{paths:Y(n.paths,e),hasM:n.hasM,hasZ:n.hasZ}:"points"in n?{points:j(n.points,e),hasM:n.hasM,hasZ:n.hasZ}:null}function Y(e,n){const s=[];for(const r of e)s.push(j(r,n));return s}function j(e,n){const s=[];for(const r of e){const i=n(r[0],r[1],[0,0]);s.push(i),r.length>2&&i.push(r[2]),r.length>3&&i.push(r[3])}return s}async function $(e,n){if(!e||!n)return;const s=Array.isArray(e)?e.map(r=>r.geometry!=null?r.geometry.spatialReference:null).filter(q):[e];await B(s.map(r=>({source:r,dest:n})))}const G=Z.bind(null,v),O=Z.bind(null,w);function nn(e,n,s,r){if(!e||(s||(s=n,n=e.spatialReference),!V(n)||!V(s)||A(n,s)))return e;if(d(n,s)){const i=z(s)?G(e):O(e);return i.spatialReference=s,i}return P(R,[e],n,s,null,r)[0]}class K{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}async push(n,s,r){if(!n||!n.length||!s||!r||A(s,r))return n;const i={geometries:n,inSpatialReference:s,outSpatialReference:r,resolve:null};return this._jobs.push(i),new Promise(l=>{i.resolve=l,this._timer===null&&(this._timer=setTimeout(this._process,10))})}_process(){this._timer=null;const n=this._jobs.shift();if(!n)return;const{geometries:s,inSpatialReference:r,outSpatialReference:i,resolve:l}=n;d(r,i)?z(i)?l(s.map(G)):l(s.map(O)):l(P(R,s,r,i,null,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}}const Q=new K;function en(e,n,s){return Q.push(e,n,s)}export{en as M,$ as f,nn as g,X as t};
